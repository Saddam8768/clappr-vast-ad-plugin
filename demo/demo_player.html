<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>clappr ad plugin</title>
    <!--<script src="http://cdn.clappr.io/latest/clappr.min.js"></script>-->
    <script src="../clappr-1142-20161018.js"></script>
    <script src="../dist/ad_plugin.js"></script>
    <script src="../dist/vast_parser.js"></script>
    <script src="../dist/ad_button.js"></script>
    <!--<script src="../src/vast_parser.js"></script>-->
    <!--<script src="../src/ad_plugin.js"></script>-->
    <!--<script src="../dist/clappr_ad_plugin.js"></script>-->
</head>
<body>
<div id="player"></div>
<script>
    //    get vast and parse mediaFile
    var parser = new Parser('');
    parser.get_vast('https://d11.cdnvideo.ru/videojs/vast-parser-copy/vast-google-sample.xml');
    var AdMediaFile = parser.get_media_file();

    // playlist with ad-video and main video
    var playlist = [
        AdMediaFile,
        'http://d11.cdnvideo.ru/videojs/files/h264-high-aac.mp4',
    ];

//    var z = 'pew called';
//    var t = ['1', '2', '3'];
//
//    function pew(zz, tt) {
//        console.log(zz);
//        console.log(tt);
//    }

//    playlist.shift();
//    pew(playlist, z);


    var player = new Clappr.Player({
        source: playlist.shift(),
//        source: "http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4",
//        poster: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/HelloWorld.svg/512px-HelloWorld.svg.png",
        parentId: "#player",
        hideMediaControl: false,
        mediacontrol: {external: mediaControlSeekDisable},
        autoPlay: true,
        plugins: [adButton]
    });

    // fired when clip ended
    player.on(Clappr.Events.PLAYER_ENDED, function () {
        skipAd(player, playlist);
    });

    function skipAd(currentPlayer, plst) {
        console.log(plst);
        console.log(playlist);
        //    delete player and create new with new config
        function reloadClappr(plr, newconf) {
            var newplayer = plr.configure(newconf);
//            v.onclick = '';
            newplayer = new Clappr.Player(newplayer.options);
            plr.destroy();
            currentPlayer = newplayer;
        }

        if (playlist.length > 0) {
            reloadClappr(player, {
                mediacontrol: {seekbar: "#ff43a4", buttons: "#ff43a4"},
                autoPlay: true,
                hideMediaControl: false,
            });
            currentPlayer.load(playlist.shift());
            let ab = document.getElementById('adButton');
            ab.parentNode.removeChild(ab);
        }
    }

    var a = new adPlugin(skipoffset = 3000);
</script>
</body>
</html>