"use strict";var adVideoPlayNow=true;var mainVideoPlayNow=false;var preroll=true;var pauseroll=false;var sbPressed=false;var adFirstStart=true;var skipButtonPressed=false;var progressEventsSeconds=[];var getCurrentDate=function getCurrentDate(){var d=new Date;return"("+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+") "};var _visibilityAPI=function(){var stateKey,eventKey,keys={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(stateKey in keys){if(stateKey in document){eventKey=keys[stateKey];break}}return{"setHandler":function setHandler(c){if(c)document.addEventListener(eventKey,c)},"tabVisible":function tabVisible(){return!document[stateKey]}}}();_visibilityAPI.setHandler(function(){if(adVideoPlayNow){if(_visibilityAPI.tabVisible()){setTimeout(function(){player.play()},300)}else{player.pause()}}});var clapprAdVastPlugin=Clappr.UIContainerPlugin.extend({name:"clappr-vast-ad-plugin",version:"2.0",adMuted:false,initialize:function initialize(){this.render();this.checkAdTime()},render:function render(){this.$el.css("font-size","20px");this.$el.css("position","absolute");this.$el.css("color","white");this.$el.css("top","70%");this.$el.css("right","0%");this.$el.css("background-color","black");this.$el.css("z-index","100500");this.$el.css("border","solid 3px #333333");this.$el.css("padding","5px");this.container.$el.append(this.$el);this.$el[0].id="adButton";if(preroll){this.show()}else if(pauseroll){if(adVideoPlayNow){this.show()}else{this.hide()}}return this},bindEvents:function bindEvents(){this.listenTo(this.container,Clappr.Events.CONTAINER_ENDED,this.containerEnded);this.listenTo(this.container,Clappr.Events.CONTAINER_PLAY,this.containerPlay);this.listenTo(this.container,Clappr.Events.CONTAINER_VOLUME,this.containerVolume);this.listenTo(this.container,Clappr.Events.CONTAINER_PAUSE,this.containerPause);this.listenTo(this.container,Clappr.Events.CONTAINER_CLICK,this.containerClick)},containerClick:function containerClick(){if(adVideoPlayNow){window.open(clickLink).focus();vastTracker.click()}else{player.pause()}},containerPause:function containerPause(){if(adVideoPlayNow&&!player.ended){vastTracker.setPaused(true)}if(!adVideoPlayNow){player.pause()}},containerVolume:function containerVolume(){if(adVideoPlayNow&&player){if(player.getVolume()==0&&!this.AdMuted||player.getVolume()!=0&&this.AdMuted){this.AdMuted=!this.AdMuted;vastTracker.setMuted(this.AdMuted)}}},containerPlay:function containerPlay(){mainVideoPlayNow?this.hide():null;player.core.mediaControl.container.settings.seekEnabled=!adVideoPlayNow;if(adVideoPlayNow){if(adFirstStart){vastTracker.setProgress(0.1);adFirstStart=false}else{vastTracker.setPaused(false)}}},containerEnded:function containerEnded(){vastTracker.complete();this.switchSource()},switchSource:function switchSource(){if(player!=null){(function(){adVideoPlayNow=false;mainVideoPlayNow=true;var le=videoAd;var el=player.core.getCurrentPlayback().el;var endListener=function endListener(){el.removeEventListener("ended",endListener);el.src=le;el.load()};el.src=videoMain;el.load();el.addEventListener("ended",endListener);!sbPressed?el.play():null})()}},show:function show(){var _this=this;var showAdButton=function showAdButton(){_this.$el.show();var timerId=setInterval(function(){var ab=document.getElementById("adButton");ab.textContent="You can skip this ad in "+parseInt(skipDelay-player.getCurrentTime());if(player.getCurrentTime()>skipDelay){clearInterval(timerId);ab.onclick=function(){skipButtonPressed=true;vastTracker.skip();sbPressed=true;_this.switchSource()};ab.textContent="Skip Ad"}},300)};if(preroll){if(adVideoPlayNow){showAdButton()}else{this.hide()}}else if(pauseroll){showAdButton()}},hide:function hide(){this.$el.hide()},checkAdTime:function checkAdTime(){if(adVideoPlayNow){(function(){var fq=false,mp=false,tq=false;var timerId=setInterval(function(){if(skipButtonPressed){clearInterval(timerId)}else{if(progressEventsSeconds.length&&player.getCurrentTime()>=progressEventsSeconds[0]){vastTracker.setProgress(progressEventsSeconds.shift());console.log(getCurrentDate()+" Ad event: progress")}if(player.getCurrentTime()>=player.getDuration()*0.25&&!fq){vastTracker.setProgress(player.getCurrentTime());fq=true}else if(player.getCurrentTime()>=player.getDuration()*0.5&&!mp){vastTracker.setProgress(player.getCurrentTime());mp=true}else if(player.getCurrentTime()>=player.getDuration()*0.75&&!tq){vastTracker.setProgress(player.getCurrentTime());tq=true;clearInterval(timerId)}}},300)})()}}});function outerFunc(){console.log("outer")}